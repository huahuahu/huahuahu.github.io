---
title: TCP/IP协议之广播与多播    
categories: network  
tag:    
- tcp/ip
---
  
## 一、引言  
广播和多播仅应用于UDP，适合把报文同时传给多个接收者。  
对于以太网，当地址中最高字节的最低位被设置为1时，表示该地址适合一个多播地址，用十六进制表示为`01:00:00:00:00:00`，广播`ff:ff:ff:ff:ff:ff`可以认为是多播的一个特例。  
![-w210](http://oda58fqub.bkt.clouddn.com/14893310262037.jpg)  

广播的一个问题是增加了对广播不感兴趣的主机的处理负荷。  
使用多播，主机可以加入一个或多个多播组。这样子，网卡将知悉该主机属于哪个多播组，然后仅仅接收主机所在的多播组的那些多播帧，而不必到UDP层再丢弃。  

## 二、广播的分类  
1. 受限的广播  
    广播地址是`255.255.255.255`，用于主机配置过程中IP数据报的目的地址。  
    任何情况下，路由器都不转发目的地址为受限广播地址的数据报，这样子的数据报仅仅出现在本地网络中。
2. 指向网络的广播   
    广播地址是主机号全为1的地址，A类广播地址`netid.255.255.255`。  
    一个路由器必须转发指向网络的广播，但它也必须有一个不进行转发的选择。  
3. 指向子网的广播  
    广播地址为主机号全为1且有特定子网号的地址，需要事先了解子网的掩码。
4. 指向所有子网的广播   
    貌似有点陈旧？？？  
    
## 三、多播  
### 1. 多播组地址  
![](http://oda58fqub.bkt.clouddn.com/14894903002673.jpg)  
多播没有子网的概念，分配的28bit均作为多播组号。  
能够接受发往一个特定多播组地址数据的主机集合称为主机组 (host group)。

- 一个主机组可以跨越多个网络  
- 主机组成员可以随时加入或离开主机组  
- 主机组对主机的数量没有限制  
- 不属于某一组的主机可以向该组发送信息  

#### 一些知名多播组  

- 224.0.0.1  
子网内所有系统组  
- 224.0.0.2    
自网内所有路由器组  
- 224.0.1.1   
网络时间协议NTP  
- 224.0.0.9  
RIP-2  

### 2. 多播组地址到以太网地址的转换  
IANA规定，与IP多播对应的以太网地址范围是从`01:00:5e:00:00:00`到`0a:00:5e:7f:ff:ff:ff`  
通过把多播组号的低位23bit映射到以太网地址中的低位23bit，以太网多播地址的低位23bit和IP多播组号对应  
![](http://oda58fqub.bkt.clouddn.com/14894928321380.jpg)  

这种映射规则下，每个以太网多播地址对应的多播组不是唯一的，32个不同的多播组号被映射为同一个以太网地址。

### 3. 发送多播信息（单个物理网络）  
1. 多播进程把目的IP地址指明为多播地址  
2. 设备驱动程序把IP地址转化为对应的以太网地址  
3. 设备驱动程序把数据发出去  

### 4. 接收多播信息  
1. 接收进程通知IP层想接收的发往指定多播地址的数据报，称之为“加入一个多播组”  
2. 主机接收到多播数据报时，向属于这个多播组的每一个进程均传送一个复制  

**注意：**   

- 使用多播，一个主机可能存在多个属于同一多播组的进程  
- 同一个主机或多个主机上可能存在多个接收者  

## 四、一张有趣的图  
![](http://oda58fqub.bkt.clouddn.com/14894943364598.jpg)


